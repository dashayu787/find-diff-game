<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>97 Encontre as Diferen√ßas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #f0f0f0;
      height: 100%;
      font-family: Arial, sans-serif;
    }
    #game-container { width: 100vw; height: 100vh; }
    canvas { display: block; width: 100% !important; height: 100% !important; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
  <script>eruda.init();</script>
</head>
<body>
  <div id="game-container"></div>

  <script>
    // ---------------- Âü∫Êú¨ÈÖçÁΩÆ ----------------
    const BASE_WIDTH  = 360;
    const BASE_HEIGHT = 720;
    const IMAGE_H_RATIO = 0.42;   // ÊØèÂº†ÂõæÂç†Â±èÂπïÈ´òÂ∫¶ÁöÑ 42%
    const BAR_H_BASE   = 40;      // ÁªøËâ≤Êù°Âü∫Á°ÄÈ´òÂ∫¶Ôºà‰ºöÈöèÂ±èÂπïÁº©ÊîæÔºâ
    const PADDING_BASE = 12;      // ÁªøËâ≤Êù°ÂÜÖËæπË∑ù
    const HIT_RADIUS_BASE = 25;   // ÂëΩ‰∏≠ÂçäÂæÑÔºà‰ºöÈöèÂ±èÂπïÁº©ÊîæÔºâ

    const config = {
      type: Phaser.AUTO,
      parent: 'game-container',
      scale: {
        mode: Phaser.Scale.FIT,
        autoCenter: Phaser.Scale.CENTER_BOTH,
        width: BASE_WIDTH,
        height: BASE_HEIGHT
      },
      backgroundColor: '#f0f0f0',
      scene: { preload, create }
    };

    // ---------------- Ê∏∏ÊàèÁä∂ÊÄÅ ----------------
    let timeLeft = 60;
    let score = 0;
    let gameOver = false;

    let timerText, scoreText, titleText;
    let topImage, bottomImage;
    let topY0, bottomY0; // ‰∏§Âº†ÂõæÁöÑÈ°∂ÈÉ® y
    let hitRadiusWorld;
    let timerEvt;

    // Â∑ÆÂºÇÁÇπÔºàÊåâ‰Ω†ÂéüÊù•ÁöÑ‚Äú‰∏äÂõæ‚ÄùÂùêÊ†áÔºåÂÖàËΩ¨‰∏∫ 0..1Ôºâ
    const differencePointsBase = [
      { x: 100, y: 120 },
      { x: 250, y: 300 },
      { x: 180, y: 180 }
    ];
    const points = differencePointsBase.map(p => ({
      u: p.x / BASE_WIDTH,
      v: p.y / (BASE_HEIGHT * IMAGE_H_RATIO)
    }));
    const foundSet = new Set();

    const game = new Phaser.Game(config);

    function preload() {
      // Ê≥®ÊÑèÔºö‰Ω†ÁöÑÂõæÁâáÂú∞ÂùÄÊòØ .png.pngÔºåÂ¶ÇÈùûÂàªÊÑèËØ∑ÊîπÊàê .png
      this.load.image('topImage',    'https://cdn.jsdelivr.net/gh/dashayu787/my-image-cdn/img/level1_a.png.png');
      this.load.image('bottomImage', 'https://cdn.jsdelivr.net/gh/dashayu787/my-image-cdn/img/level1_b.png.png');
      this.load.atlas('flares',
        'https://labs.phaser.io/assets/particles/flares.png',
        'https://labs.phaser.io/assets/particles/flares.json'
      );
    }

function create() {
  const scene = this;
  const sw = this.scale.width;
  const sh = this.scale.height;
  const scaleX = sw / BASE_WIDTH;
  const scaleY = sh / BASE_HEIGHT;

  hitRadiusWorld = HIT_RADIUS_BASE * scaleX;

  // ‰∏äÂõæ
  const topH = sh * IMAGE_H_RATIO;
  topImage = this.add.image(sw / 2, topH / 2, 'topImage')
                     .setDisplaySize(sw, topH);
  topY0 = topImage.y - topImage.displayHeight / 2;

  // ÁªøËâ≤Êù°Ôºà‰∏é‰∏äÂõæÂ∑¶Âè≥ÈΩêËæπÔºåÁ¥ßË¥¥‰∏äÂõæÂ∫ïÈÉ®Ôºâ
  const barH = BAR_H_BASE * scaleY;
  const padding = PADDING_BASE * scaleX;
  const barTop = topY0 + topImage.displayHeight;
  const barCenter = barTop + barH / 2;
  this.add.rectangle(sw / 2, barCenter, sw, barH, 0x009739).setOrigin(0.5);

  // ‚Äî‚Äî ‰∏ÄË°åÊñáÂ≠óÔºöÂ∑¶(ÂÄíËÆ°Êó∂) ‚Äî ‰∏≠(Ê†áÈ¢ò) ‚Äî Âè≥(ÂæóÂàÜ) ‚Äî‚Äî
  const styleSmall = { fontFamily: 'Arial', fontSize: '14px', color: '#FFD700', fontStyle: 'bold' };
  const styleTitle = { fontFamily: 'Arial', fontSize: '18px', color: '#FFD700', fontStyle: 'bold' };

  timerText = this.add.text(padding, barCenter, 'TMP: 60', styleSmall)
                      .setOrigin(0, 0.5);     // Â∑¶ÂØπÈΩê + ÂûÇÁõ¥Â±Ö‰∏≠
  scoreText = this.add.text(sw - padding, barCenter, 'PTS: 0', styleSmall)
                      .setOrigin(1, 0.5);     // Âè≥ÂØπÈΩê + ÂûÇÁõ¥Â±Ö‰∏≠
  titleText = this.add.text(sw / 2, barCenter, '97 Diferen√ßas', styleTitle)
                      .setOrigin(0.5, 0.5);   // Â±Ö‰∏≠

  // ËÆ©Ê†áÈ¢òÂßãÁªà‰Ωç‰∫é‚ÄúÂÄíËÆ°Êó∂‚ÄùÂíå‚ÄúÂæóÂàÜ‚ÄùÁöÑ‰∏≠ÁÇπÔºà‰øùÊåÅ‰∏ÄË°åÂØπÈΩêÔºâ
  function layoutHeader() {
    const y = barCenter;
    timerText.setY(y);
    scoreText.setY(y);
    const leftEdge  = timerText.x + timerText.width;       // Â∑¶‰æßÊñáÂ≠óÁöÑÂè≥ËæπÁïå
    const rightEdge = scoreText.x - scoreText.width;       // Âè≥‰æßÊñáÂ≠óÁöÑÂ∑¶ËæπÁïå
    const mid = (leftEdge + rightEdge) / 2;                // ‰∏§ËÄÖ‰∏≠ÁÇπ
    titleText.setPosition(mid, y);                         // Ê†áÈ¢òÊîæÂú®‰∏≠ÁÇπ
  }
  layoutHeader();

  // ‰∏ãÂõæÔºà‰∏éÁªøËâ≤Êù°‰∏ãËæπÁ¥ßË¥¥Ôºâ
  const bottomH = sh * IMAGE_H_RATIO;
  const bottomTop = barTop + barH;
  bottomImage = this.add.image(sw / 2, bottomTop + bottomH / 2, 'bottomImage')
                        .setDisplaySize(sw, bottomH);
  bottomY0 = bottomImage.y - bottomImage.displayHeight / 2;

  // ÁÇπÂáªÂëΩ‰∏≠
  this.input.on('pointerdown', (pointer) => {
    if (gameOver) return;
    const mx = pointer.x, my = pointer.y;

    for (let i = 0; i < points.length; i++) {
      if (foundSet.has(i)) continue;
      const { u, v } = points[i];
      const px = u * sw;
      const pyTop = topY0 + v * topImage.displayHeight;
      const pyBottom = bottomY0 + v * bottomImage.displayHeight;

      const hit = (Phaser.Math.Distance.Between(mx, my, px, pyTop) <= hitRadiusWorld) ||
                  (Phaser.Math.Distance.Between(mx, my, px, pyBottom) <= hitRadiusWorld);

      if (hit) {
        foundSet.add(i);
        score++;
        scoreText.setText('PTS: ' + score);
        drawHit.call(scene, px, pyTop);
        drawHit.call(scene, px, pyBottom);
        layoutHeader(); // ÂàÜÊï∞ÂèòÂåñÂêéÈáçÊñ∞ÊéíÁâàÔºà‰øùÊåÅ‰∏ÄË°åÔºâ
        if (score >= points.length) endGame.call(scene, true);
        return;
      }
    }
  });

  // ËÆ°Êó∂
  timerEvt = this.time.addEvent({
    delay: 1000,
    loop: true,
    callback: () => {
      if (gameOver) return;
      timeLeft--;
      timerText.setText('TMP: ' + timeLeft);
      timerText.setColor(timeLeft <= 10 ? '#ff0000' : '#FFD700');
      layoutHeader(); // ÊñáÊú¨ÂèòÊõ¥ÂêéÈáçÊñ∞ÊéíÁâàÔºà‰øùÊåÅ‰∏ÄË°åÔºâ
      if (timeLeft <= 0) endGame.call(scene, false);
    }
  });
}

    // ÁîªÂëΩ‰∏≠Ê†áËÆ∞
    function drawHit(x, y) {
      const r = Math.max(10, hitRadiusWorld * 0.5);
      const fill = this.add.circle(x, y, r, 0xff0000, 0.6);
      const ring = this.add.circle(x, y, r + 4, 0xff0000, 0).setStrokeStyle(2, 0xff0000, 0.9);
      this.tweens.add({ targets: ring, scale: 1.4, alpha: 0, duration: 500, onComplete: () => ring.destroy() });
    }

    // ÁªìÊùü
    function endGame(win) {
      if (gameOver) return;
      gameOver = true;
      this.input.enabled = false;
      if (timerEvt) { timerEvt.remove(false); timerEvt = null; }

      const sw = this.scale.width, sh = this.scale.height;
      const msg = win ? `üéâ Fim de jogo!\nPTS: ${score}/${points.length} üéâ`
                      : `‚è±Ô∏è Tempo esgotado!\nPTS: ${score}/${points.length}`;

      this.add.text(sw / 2, sh * 0.5, msg, {
        fontSize: '22px', fill: '#ffffff',
        backgroundColor: win ? '#4CAF50' : '#ff5252',
        align: 'center', padding: { x: 12, y: 10 }
      }).setOrigin(0.5);

      const particles = this.add.particles('flares');
      const emitter = particles.createEmitter({
        frame: ['red', 'green', 'blue', 'yellow'],
        x: { min: 0, max: sw }, y: 0,
        lifespan: 2000, speedY: { min: 200, max: 400 },
        scale: { start: 0.5, end: 0 }, quantity: 4, blendMode: 'ADD'
      });
      this.time.delayedCall(3000, () => { emitter.stop(); this.time.delayedCall(1000, () => particles.destroy()); });
    }
  </script>
</body>
</html>
